<%- include("../partials/admin/header", { title: "Products" , adminName: typeof adminName !=="undefined" ? adminName
    : "Admin" , activeMenu: activeMenu }) %>

    <div class="dashboard-content" style="padding: 20px 17px;">



        <div class="content-header"
        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    
        <h1 style="font-size:28px; font-weight:600; color:#333;">Products</h1>
    
        <div style="display:flex; align-items:center; gap:10px;">
    
        
            <form action="/admin/products" method="GET" style="display:flex; gap:8px;">
                <input 
                    type="text" 
                    name="search" 
                    placeholder="Search products..." 
                    value="<%= query.search || '' %>"
                    style="padding:10px; border:1px solid #ccc; border-radius:5px;"
                >
                <button type="submit" 
                    style="padding:10px 14px; border:none; background:#1e90ff; color:white; border-radius:5px;">
                    Search
                </button>
            </form>
    
           
            <a href="/admin/addProducts"
                style="background:#ff4757; padding:10px 18px; color:white; border-radius:6px; text-decoration:none;">
                Add Product
            </a>
    
        </div>
    </div>
    

        <div class="product-page-container">

    <table class="product-page-table">

        <thead>
            <tr>
                <th>Image</th>
                <th>Product Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            <% data.forEach(product => { %>
            <tr>
                <td>
                    <img 
                        class="product-page-img"
                        src="<%= product.images?.length > 0 
                            ? '/uploads/product-images/' + product.images[0] 
                            : '/images/no-image.png' %>"
                    >
                </td>

                <td class="product-page-name">
                    <%= product.product_name %>
                </td>

                <td><%= product.category_id ? product.category_id.name : "" %></td>

                <td>â‚¹ <%= product.sale_price %></td>

                <td><%= product.stock %></td>

                <td>
                    <div class="product-page-actions">

                        <i class="fa-solid fa-pen-to-square product-page-edit"
                            onclick="window.location.href='/admin/editProducts/<%= product._id %>'">
                        </i>

                        <i class="fa-solid fa-trash product-page-delete"
                            onclick="confirmDelete('<%= product._id %>')">
                        </i>

                    </div>
                </td>
            </tr>
            <% }) %>
        </tbody>

    </table>

</div>




        <nav aria-label="Page Navigation">
            <ul class="pagination">

                <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                    <a class="page-link" href="?page=1">First</a>
                </li>

                <% for (let i=1; i <=totalPages; i++) { %>
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= i %>">
                            <%= i %>
                        </a>
                    </li>
                    <% } %>

                        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                            <a class="page-link" href="?page=<%= totalPages %>">Last</a>
                        </li>

            </ul>
        </nav>



    </div>


<script>
function confirmDelete(productId) {
    Swal.fire({
        title: "Are you sure?",
        text: "This product will be deleted",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#ff4757",
        cancelButtonColor: "#6c757d",
        confirmButtonText: "Yes, delete it!"
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = `/admin/deleteProduct/${productId}`;
        }
    });
}
</script>

    <%- include("../partials/admin/footer") %>